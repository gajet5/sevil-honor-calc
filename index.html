<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä Honor System</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #1e1e1e;
            color: #e0e0e0;
            line-height: 1.4;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 100%;
        }

        .section {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #444;
        }

        h1, h2, h3 {
            color: #ffd700;
            margin-bottom: 12px;
            font-size: clamp(16px, 4vw, 24px);
        }

        h2 {
            font-size: clamp(14px, 3.5vw, 20px);
        }

        h3 {
            font-size: clamp(13px, 3vw, 18px);
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            font-size: clamp(12px, 3vw, 14px);
        }

        input, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background: #3d3d3d;
            border: 1px solid #555;
            border-radius: 6px;
            color: #fff;
            font-size: 16px;
            min-height: 44px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        button {
            background: #ffd700;
            color: #1e1e1e;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: clamp(12px, 3vw, 14px);
            flex: 1;
            min-width: 120px;
            min-height: 44px;
        }

        button:hover {
            background: #ffed4a;
        }

        .info-box {
            background: #363636;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: clamp(11px, 2.8vw, 13px);
        }

        small {
            color: #aaa;
            font-size: 12px;
        }

        /* –¢–∞–±–ª–∏—Ü—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        .table-container {
            overflow-x: auto;
            margin: 10px 0;
            -webkit-overflow-scrolling: touch;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 500px;
            font-size: clamp(10px, 2.5vw, 12px);
        }

        th, td {
            border: 1px solid #555;
            padding: 8px 6px;
            text-align: center;
            white-space: nowrap;
        }

        th {
            background: #444;
            color: #ffd700;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background: #363636;
        }

        /* –ë–µ–π–¥–∂–∏ —É—Ä–æ–≤–Ω–µ–π */
        .tier-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: clamp(9px, 2.5vw, 11px);
            font-weight: bold;
            margin: 1px;
        }

        .tier-top { background: #ff6b6b; color: #000; }
        .tier-high { background: #ffa500; color: #000; }
        .tier-medium { background: #4ecdc4; color: #000; }
        .tier-low { background: #45b7d1; color: #000; }
        .tier-minimal { background: #96ceb4; color: #000; }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –≥—Ä—É–ø–ø—ã */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .summary-item {
            background: #363636;
            padding: 10px;
            border-radius: 6px;
            font-size: clamp(11px, 2.8vw, 13px);
        }

        /* –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º */
        .table-nav {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            gap: 10px;
        }

        .table-nav button {
            flex: 1;
            min-width: auto;
            padding: 8px 12px;
            font-size: clamp(10px, 2.5vw, 12px);
        }

        /* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .section {
                padding: 12px;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                min-width: 100%;
            }

            table {
                min-width: 600px;
            }

            th, td {
                padding: 6px 4px;
            }
        }

        /* –ü–æ—Ä—Ç—Ä–µ—Ç–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è */
        @media (max-width: 768px) and (orientation: portrait) {
            .container {
                gap: 12px;
            }
        }

        /* –õ–∞–Ω–¥—à–∞—Ñ—Ç–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è */
        @media (max-width: 768px) and (orientation: landscape) {
            .container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .input-section {
                grid-column: 1;
            }

            .results-section {
                grid-column: 2;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="section input-section">
        <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—á–µ—Ç–∞</h2>

        <div class="input-group">
            <label for="rankOrRp">üéØ –†–∞–Ω–≥ –∏–ª–∏ RP:</label>
            <input type="text" id="rankOrRp" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 9.4 –∏–ª–∏ 5000">
            <small>–í–≤–µ–¥–∏—Ç–µ —Ä–∞–Ω–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä 9.4) –∏–ª–∏ RP (–Ω–∞–ø—Ä–∏–º–µ—Ä 5000)</small>
        </div>

        <div class="input-group">
            <label for="standing">üìä –ü–æ–∑–∏—Ü–∏—è (Standing):</label>
            <input type="number" id="standing" value="1" min="1">
        </div>

        <div class="input-group">
            <label for="poolSize">üë• –†–∞–∑–º–µ—Ä –ø—É–ª–∞ –∏–≥—Ä–æ–∫–æ–≤:</label>
            <input type="number" id="poolSize" value="100" min="1" max="1000">
        </div>

        <div class="button-group">
            <button onclick="calculate()">üìä –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
            <button onclick="resetToDefault()">üîÑ –°–±—Ä–æ—Å</button>
        </div>

        <div class="info-box">
            <strong>üìà BRK –∑–Ω–∞—á–µ–Ω–∏—è (1.12+ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ):</strong><br>
            0.010, 0.025, 0.045, 0.075, 0.120, 0.180, 0.250, 0.330, 0.420, 0.520, 0.630, 0.750, 0.880, 1.000
        </div>

        <div class="info-box">
            <strong>üèÜ RP –Ω–∞–≥—Ä–∞–¥—ã (FY):</strong><br>
            0, 400, 1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000, 11000, 12000, 13000
        </div>
    </div>

    <div class="section results-section">
        <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>

        <div id="playerResults" class="info-box" style="display: none;">
            <h3>üë§ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –∏–≥—Ä–æ–∫–∞</h3>
            <div id="playerResultsContent" class="summary-grid"></div>
        </div>

        <div class="table-nav">
            <button onclick="showTable('breakpoint')">üìã –ë—Ä–µ–π–∫–ø–æ–∏–Ω—Ç—ã</button>
            <button onclick="showTable('standing')">üéØ –ü–æ–∑–∏—Ü–∏–∏</button>
            <button onclick="showTable('summary')">üìà –°–≤–æ–¥–∫–∞</button>
        </div>

        <div id="breakpointTable" class="table-section">
            <h3>üéØ –ë—Ä–µ–π–∫–ø–æ–∏–Ω—Ç—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è</h3>
            <div class="table-container">
                <table>
                    <thead>
                    <tr>
                        <th>BRK</th>
                        <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                        <th>–ü–æ–∑–∏—Ü–∏—è</th>
                        <th>RP</th>
                        <th>%</th>
                    </tr>
                    </thead>
                    <tbody id="breakpointBody">
                    </tbody>
                </table>
            </div>
        </div>

        <div id="standingTable" class="table-section" style="display: none;">
            <h3>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º</h3>
            <div class="table-container">
                <table>
                    <thead>
                    <tr>
                        <th>–ü–æ–∑.</th>
                        <th>–£—Ä–æ–≤–µ–Ω—å</th>
                        <th>RP</th>
                        <th>–ü—Ä–∏–º–µ—Ä CP</th>
                        <th>–†–∞—Å—á–µ—Ç RP</th>
                    </tr>
                    </thead>
                    <tbody id="standingBody">
                    </tbody>
                </table>
            </div>
        </div>

        <div id="summaryTable" class="table-section" style="display: none;">
            <h3>üìà –°–≤–æ–¥–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è</h3>
            <div id="summaryContent" class="summary-grid">
            </div>
        </div>
    </div>
</div>

<script>
  // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–∑ HonorMgr.cpp
  const DEFAULT_BRK = [
    0.010,  // BRK[13]
    0.025,  // BRK[12]
    0.045,  // BRK[11]
    0.075,  // BRK[10]
    0.120,  // BRK[9]
    0.180,  // BRK[8]
    0.250,  // BRK[7]
    0.330,  // BRK[6]
    0.420,  // BRK[5]
    0.520,  // BRK[4]
    0.630,  // BRK[3]
    0.750,  // BRK[2]
    0.880,  // BRK[1]
    1.000   // BRK[0]
  ];

  const RP_REWARDS = [
    0,      // FY[0]
    400,    // FY[1]
    1000,   // FY[2]
    2000,   // FY[3]
    3000,   // FY[4]
    4000,   // FY[5]
    5000,   // FY[6]
    6000,   // FY[7]
    7000,   // FY[8]
    8000,   // FY[9]
    9000,   // FY[10]
    10000,  // FY[11]
    11000,  // FY[12]
    12000,  // FY[13]
    13000   // FY[14]
  ];

  // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
  const DECAY_RATE = 0.2;

  let currentTable = 'breakpoint';

  // –§—É–Ω–∫—Ü–∏–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ä–∞–Ω–≥–∞ –∏ RP
  function rank2rp(rank) {
    var _rank = Math.floor(rank);
    if (rank >= 3.0) {
      return Math.round((rank - 2.0) * 5000.0);
    } else if (rank >= 2.0) {
      return Math.round(2000 + (rank - 2.0) * 3000);
    }
    return 0;
  }

  function rp2rank(rp) {
    if (rp >= 5000.0) {
      return rp / (5000.0) + 2.0;
    } else if (rp >= (2000.0)) {
      return 2.0;
    }
    return 1.0;
  }

  function delta(rp, gain) {
    var decay = Math.floor(Math.round(rp * DECAY_RATE));
    var diff = gain - decay;
    if (diff < 0) {
      diff /= 2.0;
    }
    if (diff < -2500) {
      diff = -2500;
    }
    return diff;
  }

  function round4dec(num) {
    return Number(num.toFixed(4));
  }

  function round1dec(num) {
    return Number(num.toFixed(1));
  }

  function groups(players) {
    return DEFAULT_BRK.map(break_pt => Math.floor(Math.round(break_pt * players)));
  }

  function bracket(standing, groups) {
    var brkt = 1.0;
    var upperBound = 1.0;
    var lowerBound = 1.0;
    for (i = 0; i < groups.length; ++i) {
      var grp = groups[i];
      if (standing <= grp) {
        lowerBound = grp;
        break;
      }
      upperBound = Number(grp) + 1.0;
      brkt += 1.0;
    }
    return {
      'number': brkt,
      'rankCutoff': Number(14.0 - brkt + 1.0),
      'upperSt': upperBound,
      'lowerSt': lowerBound,
      'players': lowerBound - upperBound + 1.0,
      'upperRp': RP_REWARDS[RP_REWARDS.length - 1 - (brkt - 1)],
      'lowerRp': RP_REWARDS[RP_REWARDS.length - 1 - brkt]
    };
  }

  function estimate(parameters) {
    const CALC_RP = rank2rp(parameters.rank);
    const grps = groups(parameters.players);
    const brkt = bracket(parameters.standing, grps);
    const standingRelativeToBracket = (brkt.lowerSt - parameters.standing + 1.0) / brkt.players;

    const RP_GAIN_ESTIMATE = (brkt.upperRp - brkt.lowerRp) * standingRelativeToBracket + brkt.lowerRp;
    const DELTA = delta(CALC_RP, RP_GAIN_ESTIMATE);
    const RP_AFTER_GAIN_ESTIMATE = CALC_RP + DELTA;
    const RANK_ESTIMATE = round4dec(rp2rank(RP_AFTER_GAIN_ESTIMATE));

    const MAX_DELTA = delta(CALC_RP, brkt.upperRp);
    const MIN_DELTA = delta(CALC_RP, brkt.lowerRp);
    const RP_AFTER_MAX_GAIN = CALC_RP + MAX_DELTA;
    const RP_AFTER_MIN_GAIN = CALC_RP + MIN_DELTA;
    const MAX_RANK_AFTER_UPDATE = round4dec(rp2rank(RP_AFTER_MAX_GAIN));
    const MIN_RANK_AFTER_UPDATE = round4dec(rp2rank(RP_AFTER_MIN_GAIN));

    return {
      'parameters': parameters,
      'RP': CALC_RP,
      'RPgain': RP_GAIN_ESTIMATE,
      'groups': grps,
      'bracket': brkt,
      'delta': DELTA,
      'minDelta': MIN_DELTA,
      'maxDelta': MAX_DELTA,
      'newRP': RP_AFTER_GAIN_ESTIMATE,
      'newRank': RANK_ESTIMATE,
      'minNewRP': RP_AFTER_MIN_GAIN,
      'maxNewRP': RP_AFTER_MAX_GAIN,
      'minNewRank': MIN_RANK_AFTER_UPDATE,
      'maxNewRank': MAX_RANK_AFTER_UPDATE,
    };
  }

  function showTable(tableName) {
    document.querySelectorAll('.table-section').forEach(table => {
      table.style.display = 'none';
    });

    document.getElementById(tableName + 'Table').style.display = 'block';
    currentTable = tableName;
  }

  function calculateBreakpoints(poolSize) {
    const breakpoints = [];

    for (let i = 0; i < DEFAULT_BRK.length; i++) {
      const brkValue = DEFAULT_BRK[i];
      const position = Math.floor(brkValue * poolSize + 0.5);
      const rpReward = RP_REWARDS[RP_REWARDS.length - 1 - i];

      breakpoints.push({
        index: i,
        value: brkValue,
        position: position,
        rpReward: rpReward,
        percentile: (brkValue * 100).toFixed(1) + '%'
      });
    }

    return breakpoints;
  }

  function generateStandingList(poolSize, breakpoints) {
    const standings = [];
    const groups = [];

    for (let i = breakpoints.length - 1; i > 0; i--) {
      const startPos = breakpoints[i].position + 1;
      const endPos = breakpoints[i - 1].position;
      const minRP = breakpoints[i].rpReward;
      const maxRP = breakpoints[i - 1].rpReward;

      if (startPos <= endPos) {
        groups.push({
          start: startPos,
          end: endPos,
          minRP: minRP,
          maxRP: maxRP,
          level: getTierLevel(i)
        });
      }
    }

    if (breakpoints[breakpoints.length - 1].position >= 1) {
      groups.unshift({
        start: 1,
        end: breakpoints[breakpoints.length - 1].position,
        minRP: breakpoints[breakpoints.length - 1].rpReward,
        maxRP: breakpoints[breakpoints.length - 1].rpReward,
        level: '–¢–û–ü'
      });
    }

    for (const group of groups) {
      const positionsInGroup = group.end - group.start + 1;
      let cpBase = (14000 - group.start * 100);

      for (let pos = group.start; pos <= group.end; pos++) {
        const exampleCP = Math.max(100, cpBase - (pos - group.start) * 80);
        const calculatedRP = calculateRpForPosition(pos, group.minRP, group.maxRP, positionsInGroup);

        standings.push({
          position: pos,
          level: group.level,
          rpRange: `${group.minRP}-${group.maxRP}`,
          exampleCP: Math.round(exampleCP),
          calculatedRP: Math.round(calculatedRP)
        });
      }
    }

    return { standings, groups };
  }

  function calculateRpForPosition(position, minRP, maxRP, groupSize) {
    if (groupSize <= 1) return maxRP;
    const progress = (position - 1) / (groupSize - 1);
    return minRP + (maxRP - minRP) * (1 - progress);
  }

  function getTierLevel(brkIndex) {
    const levels = ['–¢–û–ü', '–í–´–°–û–ö–ò–ô', '–°–†–ï–î–ù–ò–ô', '–ù–ò–ó–ö–ò–ô', '–ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô'];
    const levelIndex = Math.min(Math.floor(brkIndex / 3), levels.length - 1);
    return levels[levelIndex];
  }

  function getTierBadge(level) {
    const tierClasses = {
      '–¢–û–ü': 'tier-top',
      '–í–´–°–û–ö–ò–ô': 'tier-high',
      '–°–†–ï–î–ù–ò–ô': 'tier-medium',
      '–ù–ò–ó–ö–ò–ô': 'tier-low',
      '–ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô': 'tier-minimal'
    };

    return `<span class="tier-badge ${tierClasses[level] || ''}">${level}</span>`;
  }

  function calculate() {
    const rankOrRp = document.getElementById('rankOrRp').value;
    const standing = parseInt(document.getElementById('standing').value);
    const poolSize = parseInt(document.getElementById('poolSize').value);

    if (poolSize < 1) {
      alert('–†–∞–∑–º–µ—Ä –ø—É–ª–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º');
      return;
    }

    if (standing < 1 || standing > poolSize) {
      alert('–ü–æ–∑–∏—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–µ–∂–¥—É 1 –∏ —Ä–∞–∑–º–µ—Ä–æ–º –ø—É–ª–∞');
      return;
    }

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –≤–≤–µ–¥–µ–Ω —Ä–∞–Ω–≥ –∏–ª–∏ RP
    let rank, rp;
    if (rankOrRp && !isNaN(rankOrRp)) {
      const value = parseFloat(rankOrRp);
      if (value > 15) {
        // –ï—Å–ª–∏ —á–∏—Å–ª–æ –±–æ–ª—å—à–µ 15, —Å—á–∏—Ç–∞–µ–º —á—Ç–æ —ç—Ç–æ RP
        rp = value;
        rank = rp2rank(rp);
      } else {
        // –ò–Ω–∞—á–µ —Å—á–∏—Ç–∞–µ–º —á—Ç–æ —ç—Ç–æ —Ä–∞–Ω–≥
        rank = value;
        rp = rank2rp(rank);
      }
    } else {
      // –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–Ω–≥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      rank = 1;
      rp = 0;
    }

    // –†–∞—Å—á–µ—Ç –±—Ä–µ–π–∫–ø–æ–∏–Ω—Ç–æ–≤
    const breakpoints = calculateBreakpoints(poolSize);
    displayBreakpoints(breakpoints);

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–∑–∏—Ü–∏–π
    const { standings, groups } = generateStandingList(poolSize, breakpoints);
    displayStandings(standings);
    displaySummary(groups, poolSize);

    // –†–∞—Å—á–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∏–≥—Ä–æ–∫–∞
    if (rankOrRp) {
      const estimation = estimate({
        rank: rank,
        standing: standing,
        players: poolSize
      });
      displayPlayerResults(estimation, rank, rp);
    }
  }

  function displayPlayerResults(estimation, rank, rp) {
    const playerResultsDiv = document.getElementById('playerResults');
    const contentDiv = document.getElementById('playerResultsContent');

    let html = `
                <div class="summary-item">
                    <strong>–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:</strong><br>
                    –†–∞–Ω–≥: ${round4dec(rank)}<br>
                    RP: ${rp}
                </div>
                <div class="summary-item">
                    <strong>–ü–æ–∑–∏—Ü–∏—è:</strong><br>
                    Standing: ${estimation.parameters.standing} –∏–∑ ${estimation.parameters.players}<br>
                    –ë—Ä–µ–∫–µ—Ç: ${estimation.bracket.number}
                </div>
                <div class="summary-item">
                    <strong>–û–∂–∏–¥–∞–µ–º–æ–µ RP:</strong><br>
                    –ü–æ–ª—É—á–µ–Ω–∏–µ RP: ${round1dec(estimation.RPgain)}<br>
                    –î–µ–ª—å—Ç–∞ RP: ${round1dec(estimation.delta)}<br>
                    –ù–æ–≤–æ–µ RP: ${round4dec(estimation.newRP)}
                </div>
                <div class="summary-item">
                    <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–∞–Ω–≥:</strong><br>
                    –ú–µ–∂–¥—É: r${estimation.minNewRank} –∏ r${estimation.maxNewRank}<br>
                    –û—Ü–µ–Ω–∫–∞: r${estimation.newRank}
                </div>
            `;

    contentDiv.innerHTML = html;
    playerResultsDiv.style.display = 'block';
  }

  function displayBreakpoints(breakpoints) {
    const tbody = document.getElementById('breakpointBody');
    tbody.innerHTML = '';

    for (const bp of breakpoints) {
      const row = document.createElement('tr');
      row.innerHTML = `
                    <td>${13 - bp.index}</td>
                    <td>${bp.value.toFixed(3)}</td>
                    <td>#${bp.position}</td>
                    <td>${bp.rpReward.toLocaleString()}</td>
                    <td>${bp.percentile}</td>
                `;
      tbody.appendChild(row);
    }
  }

  function displayStandings(standings) {
    const tbody = document.getElementById('standingBody');
    tbody.innerHTML = '';

    const step = standings.length > 30 ? Math.ceil(standings.length / 15) : 1;

    for (let i = 0; i < standings.length; i += step) {
      const standing = standings[i];
      const row = document.createElement('tr');
      row.innerHTML = `
                    <td>#${standing.position}</td>
                    <td>${getTierBadge(standing.level)}</td>
                    <td>${standing.rpRange}</td>
                    <td>${standing.exampleCP}</td>
                    <td>${standing.calculatedRP}</td>
                `;
      tbody.appendChild(row);
    }

    if (step > 1) {
      const infoRow = document.createElement('tr');
      infoRow.innerHTML = `<td colspan="5" style="text-align: center; font-style: italic;">
                    –ü–æ–∫–∞–∑–∞–Ω–æ ${Math.ceil(standings.length / step)} –∏–∑ ${standings.length} –ø–æ–∑–∏—Ü–∏–π
                </td>`;
      tbody.appendChild(infoRow);
    }
  }

  function displaySummary(groups, poolSize) {
    const summaryDiv = document.getElementById('summaryContent');
    let html = '';

    const activePlayers = groups.reduce((sum, group) => sum + (group.end - group.start + 1), 0);
    const inactivePlayers = Math.max(0, poolSize - activePlayers);

    html += `
                <div class="summary-item">
                    <strong>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</strong><br>
                    –ê–∫—Ç–∏–≤–Ω—ã—Ö: ${activePlayers} –∏–≥—Ä–æ–∫–æ–≤<br>
                    –ù–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö: ${inactivePlayers} –∏–≥—Ä–æ–∫–æ–≤
                </div>
            `;

    for (const group of groups) {
      const playersInGroup = group.end - group.start + 1;
      const percentage = ((playersInGroup / poolSize) * 100).toFixed(1);

      html += `
                    <div class="summary-item">
                        <strong>${getTierBadge(group.level)} –£—Ä–æ–≤–µ–Ω—å</strong><br>
                        –ú–µ—Å—Ç–∞: ${group.start}-${group.end}<br>
                        –ò–≥—Ä–æ–∫–æ–≤: ${playersInGroup} (${percentage}%)<br>
                        RP: ${group.minRP}-${group.maxRP}
                    </div>
                `;
    }

    summaryDiv.innerHTML = html;
  }

  function resetToDefault() {
    document.getElementById('rankOrRp').value = '';
    document.getElementById('standing').value = 1;
    document.getElementById('poolSize').value = 100;
    document.getElementById('playerResults').style.display = 'none';
    calculate();
  }

  window.addEventListener('resize', function() {
    if (window.innerHeight > window.innerWidth) {
      document.body.style.padding = '10px';
    } else {
      document.body.style.padding = '15px';
    }
  });

  document.addEventListener('DOMContentLoaded', function() {
    calculate();

    document.getElementById('rankOrRp').addEventListener('change', calculate);
    document.getElementById('standing').addEventListener('change', calculate);
    document.getElementById('poolSize').addEventListener('change', calculate);
  });
</script>
</body>
</html>